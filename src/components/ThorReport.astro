---
import { thorCopy, type ThorLocale } from "../data/thor";

interface Props {
  lang: ThorLocale;
}

const { lang } = Astro.props;
const copy = thorCopy[lang];

// safely stringify localized data to embed in an attribute
const scriptPayload = JSON.stringify({
  status: copy.status,
  errors: copy.errors,
  mapAria: copy.form.mapAria,
}).replace(/</g, "\\u003c");
---

<section
  class="py-8 px-4"
  data-js="thor-report"
  data-copy={scriptPayload}
>
  <div
    class="mx-auto overflow-hidden rounded-2xl border border-borderSubtle/80 bg-bgElevated/95 p-5 shadow-md sm:max-w-lg sm:p-6 lg:max-w-xl lg:p-8 dark:border-borderSubtleDark/70 dark:bg-bgElevatedDark/85"
  >
    <div class="space-y-5 sm:space-y-6 lg:space-y-7">
      <header class="space-y-2 text-center sm:text-left">
        <h2 class="text-2xl font-semibold text-fgBase sm:text-[1.65rem] lg:text-[1.8rem] dark:text-fgBaseDark">
          {copy.form.heading}
        </h2>
        <p class="text-sm text-fgMuted sm:text-base lg:text-lg dark:text-fgMutedDark">
          {copy.form.subheading}
        </p>
      </header>

      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3">
        <button
          id="use-location"
          data-js="use-location"
          type="button"
          class="rounded-lg bg-primary px-4 py-3 text-sm font-semibold text-white transition-colors duration-200 hover:bg-primarySoft focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-bgElevated disabled:cursor-not-allowed disabled:opacity-70 sm:flex-1 sm:text-base dark:bg-accentLime dark:text-black dark:hover:bg-accentLimeSoft dark:focus-visible:ring-accentLime dark:focus-visible:ring-offset-bgElevatedDark"
        >
          {copy.form.useLocation}
        </button>

        <button
          id="clear-location"
          data-js="clear-location"
          type="button"
          class="w-full rounded-lg border border-borderSubtle px-4 py-3 text-sm font-semibold text-fgBase shadow-sm transition-all duration-200 hover:border-primary hover:text-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-bgElevated sm:w-auto sm:px-5 sm:text-base dark:border-borderSubtleDark dark:text-fgBaseDark dark:hover:border-accentLime dark:hover:text-accentLime dark:focus-visible:ring-accentLime dark:focus-visible:ring-offset-bgElevatedDark"
        >
          {copy.form.clear}
        </button>
      </div>

      <p id="loc-status" data-js="loc-status" class="text-sm text-fgMuted sm:text-base dark:text-fgMutedDark">
        {copy.status.notSet}
      </p>

      <div class="space-y-4 sm:space-y-5">
        <div class="flex flex-col space-y-1.5">
          <label for="location" class="block text-sm font-medium text-fgBase sm:text-base dark:text-fgBaseDark">
            {copy.form.locationLabel}
          </label>
          <input
            id="location"
            data-js="location"
            type="text"
            inputmode="decimal"
            placeholder={copy.form.locationPlaceholder}
            class="flex-1 rounded-lg border border-borderSubtle bg-bgElevated px-4 py-2.5 text-sm text-fgBase shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/20 sm:text-base dark:border-borderSubtleDark dark:bg-bgElevatedDark dark:text-fgBaseDark dark:focus:border-accentLime dark:focus:ring-accentLime/30"
            autocomplete="off"
            autocapitalize="off"
            spellcheck="false"
          />
        </div>

        <div class="flex flex-col space-y-1.5">
          <label for="phone" class="block text-sm font-medium text-fgBase sm:text-base dark:text-fgBaseDark">
            {copy.form.phoneLabel}
          </label>
          <input
            id="phone"
            data-js="phone"
            type="tel"
            inputmode="tel"
            placeholder={copy.form.phonePlaceholder}
            autocomplete="tel"
            class="flex-1 rounded-lg border border-borderSubtle bg-bgElevated px-4 py-2.5 text-sm text-fgBase shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/20 sm:text-base dark:border-borderSubtleDark dark:bg-bgElevatedDark dark:text-fgBaseDark dark:focus:border-accentLime dark:focus:ring-accentLime/30"
          />
        </div>

        <div class="flex flex-col space-y-1.5">
          <label for="message" class="block text-sm font-medium text-fgBase sm:text-base dark:text-fgBaseDark">
            {copy.form.messageLabel}
          </label>
          <textarea
            id="message"
            data-js="message"
            rows="3"
            placeholder={copy.form.messagePlaceholder}
            class="flex-1 rounded-lg border border-borderSubtle bg-bgElevated px-4 py-2.5 text-sm text-fgBase shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/20 sm:text-base dark:border-borderSubtleDark dark:bg-bgElevatedDark dark:text-fgBaseDark dark:focus:border-accentLime dark:focus:ring-accentLime/30"
          ></textarea>
        </div>

        <input
          id="website"
          data-js="honeypot"
          name="website"
          type="text"
          autocomplete="off"
          class="hidden"
          tabindex="-1"
          aria-hidden="true"
        />
      </div>

      <button
        id="submit"
        data-js="submit"
        type="button"
        class="w-full rounded-lg bg-primary px-4 py-3 text-sm font-semibold text-white transition-colors duration-200 hover:bg-primarySoft focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-bgElevated disabled:cursor-not-allowed disabled:opacity-70 sm:text-base dark:bg-accentLime dark:text-black dark:hover:bg-accentLimeSoft dark:focus-visible:ring-accentLime dark:focus-visible:ring-offset-bgElevatedDark"
      >
        {copy.form.submit}
      </button>

      <p
        id="status"
        data-js="status"
        class="mt-2 text-center text-sm text-fgMuted sm:text-base dark:text-fgMutedDark"
        aria-live="polite"
      ></p>
    </div>
  </div>

  <script is:inline src="/scripts/thor-report.js"></script>
</section>
